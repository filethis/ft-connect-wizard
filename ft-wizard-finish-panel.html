<!--
Copyright 2017 FileThis, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->


<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-label/iron-label.html">
<link rel="import" href="../polymer/polymer.html">


<!--
`<ft-wizard-finish-panel>`

This element displays a finish of where the user stands in the process of completing the ft-connect-wizard workflow.

@demo
-->
<dom-module id="ft-wizard-finish-panel">

    <template>

        <style include="iron-flex iron-flex-alignment iron-positioning"></style>

        <style>
            :host {
                display:block;
                overflow:hidden;
                @apply --layout-vertical;
                @apply --layout-center;
                @apply --ft-wizard-finish-panel;
            }
        </style>

        <div
            class="layout vertical"
            style="width:550px; margin:30px; border:1px solid #DDD; padding:20px; "
        >

            <!-- Instructions for no connections -->
            <div
                class="layout horizontal center"
                style="margin-bottom:20px; "
                hidden$="[[!_showInstructionsNoConnections]]"
            >
                <!-- Instructions -->
                <iron-label
                    class="flex"
                    style="font-family:Arial; font-size:14pt; "
                >
                    [[instructionsNoConnections]]
                </iron-label>

                <!-- Add Connection button -->
                <paper-button
                    raised
                    style="width:120px; height:32px; font-size:14px; background-color:white; text-transform: none; border:1px solid #DDD; margin-left:16px; "
                    on-tap="_onAddConnectionButtonClicked"
                >
                    Add Connection
                </paper-button>
            </div>

            <!-- Instructions for connections still running -->
            <div
                class="layout horizontal center"
                style="margin-bottom:20px; "
                hidden$="[[!_showInstructionsConnectionsRunning]]"
            >
                <!-- Instructions -->
                <iron-label
                    class="flex"
                    style="font-family:Arial; font-size:14pt; "
                >
                    [[instructionsConnectionsRunning]]
                </iron-label>

                <!-- Show Connections button -->
                <paper-button
                    raised
                    style="width:140px; height:32px; font-size:14px; background-color:white; text-transform: none; border:1px solid #DDD; margin-left:16px; "
                    on-tap="_onViewConnectionsButtonClicked"
                >
                    Show Connections
                </paper-button>
            </div>

            <!-- Instructions for pending interactions -->
            <div
                class="layout horizontal center"
                style="margin-bottom:20px; "
                hidden$="[[!_showInstructionsPendingInteractions]]"
            >
                <!-- Instructions -->
                <iron-label
                    class="flex"
                    style="font-family:Arial; font-size:14pt; "
                >
                    [[instructionsPendingInteractions]]
                </iron-label>

                <!-- Show Connections button -->
                <paper-button
                    raised
                    style="width:140px; height:32px; font-size:14px; background-color:white; text-transform: none; border:1px solid #DDD; margin-left:16px; "
                    on-tap="_onViewConnectionsButtonClicked"
                >
                    Show Connections
                </paper-button>
            </div>

            <!-- Instructions for adding more connections -->
            <div
                class="layout horizontal center"
                style="margin-bottom:20px; "
                hidden$="[[!_showInstructionsAddMoreConnections]]"
            >
                <!-- Instructions -->
                <iron-label
                    class="flex"
                    style="font-family:Arial; font-size:14pt; "
                >
                    [[instructionsAddMoreConnections]]
                </iron-label>

                <!-- Action button -->
                <paper-button
                    raised
                    style="width:120px; height:32px; font-size:14px; background-color:white; text-transform: none; border:1px solid #DDD; margin-left:16px; "
                    on-tap="_onAddConnectionButtonClicked"
                >
                    Add Connection
                </paper-button>
            </div>

            <div
                class="layout horizontal center"
                style="margin-top:15px; "
            >

                <!-- Spacer -->
                <div class="flex"></div>

                <!-- Done button -->
                <paper-button
                    raised
                    id="doneButton"
                    hidden$="[[!showDoneButton]]"
                    style="width:90px; height:32px; font-size:14px; background-color:white; text-transform: none; border:1px solid #DDD; "
                    on-tap="_onDoneButtonClicked"
                >
                    Done
                </paper-button>
            </div>

        </div>



    </template>

    <script>
        Polymer({

            is: 'ft-wizard-finish-panel',

//            observers: [
//                '_onSituationChanged(connections, documents)'
//            ],

            properties: {

                connections:
                {
                    type: Array,
                    value: []
                },

                documents:
                {
                    type: Array,
                    value: []
                },

                /**
                 * Show a "Done" button.
                 *
                 * Note that you can provide the strings "true" and "false" as attribute values .
                 *
                 * @type {boolean}
                 */
                showDoneButton:
                {
                    type: Object,
                    value: true
                },

                instructionsNoConnections:
                {
                    type: String
                },
                _showInstructionsNoConnections:
                {
                    type: Boolean,
                    value: false
                },

                instructionsConnectionsRunning:
                {
                    type: String
                },
                _showInstructionsConnectionsRunning:
                {
                    type: Boolean,
                    value: false
                },

                instructionsPendingInteractions:
                {
                    type: String
                },
                _showInstructionsPendingInteractions:
                {
                    type: Boolean,
                    value: false
                },

                instructionsAddMoreConnections:
                {
                    type: String
                },
                _showInstructionsAddMoreConnections:
                {
                    type: Boolean,
                    value: false
                },
            },

            ready: function()
            {
                // TODO: Is this the best place for this?

                this.instructionsNoConnections =
                    "You haven't connected to any of your sites, yet.";
                this.instructionsConnectionsRunning =
                    "One or more of your connections is still running.";
                this.instructionsPendingInteractions =
                    "One or more of your connections needs your help to complete.";
                this.instructionsAddMoreConnections =
                    "Would you like to add more connections?";
            },

            _onDoneButtonClicked: function()
            {
                this.fire('wizard-done');
            },

            _onAddConnectionButtonClicked: function()
            {
                this.fire('wizard-add-connection');
            },

            _onViewConnectionsButtonClicked: function()
            {
                this.fire('wizard-view-connections');
            },

//            _onSituationChanged: function()
//            {
//                this._updateInstructions();
//            },

            // TODO: Temporary hack until we get the model updates working
            wasShown: function()
            {
                this._updateInstructions();
            },

            _updateInstructions: function()
            {
                var instructions = "";

                if (!this._haveConnections())
                {
                    this._showInstructionsNoConnections = true;
                    this._showInstructionsAddMoreConnections = false;
                    this._showInstructionsConnectionsRunning = false;
                    this._showInstructionsPendingInteractions = false;
                }
                else // have at least one connection
                {
                    var someConnectionStillRunning = this._someConnectionStillRunning();
                    var someConnectionHasPendingInteraction = this._someConnectionHasPendingInteraction();
                    this._showInstructionsNoConnections = false;
                    this._showInstructionsAddMoreConnections = true;
                    this._showInstructionsConnectionsRunning = someConnectionStillRunning && !someConnectionHasPendingInteraction;
                    this._showInstructionsPendingInteractions = someConnectionHasPendingInteraction;
                }

                this._instructions = instructions;
            },

            _haveConnections: function()
            {
                return (this.connections.length > 0);
            },

            _someConnectionStillRunning: function()
            {
                var count = this.connections.length;
                for (var index = 0; index < count; index++)
                {
                    var connection = this.connections[index];
                    if (this._connectionStillRunning(connection))
                        return true;
                }
                return false;
            },

            _someConnectionHasPendingInteraction: function()
            {
                var count = this.connections.length;
                for (var index = 0; index < count; index++)
                {
                    var connection = this.connections[index];
                    if (this._connectionHasPendingInteraction(connection))
                        return true;
                }
                return false;
            },

            _connectionStillRunning: function(connection)
            {
                switch (connection.state)
                {
                    case "waiting":
                    case "error":
                        return false;
                    default:
                        return true;
                }
            },

            _connectionHasPendingInteraction: function(connection)
            {
                return (connection.state === "question");
            },

        });
    </script>
</dom-module>
