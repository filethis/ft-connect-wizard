<!--
Copyright 2017 FileThis, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->


<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../iron-pages/iron-pages.html">
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="ft-wizard-tab.html">


<!--
`<ft-wizard-tab-bar>`

An element that implements a tab bar with arrow-shaped tabs.

@demo
-->
<dom-module id="ft-wizard-tab-bar">

    <template>

        <style include="iron-flex iron-flex-alignment iron-positioning"></style>

        <style>
            :host {
                display:block;
                overflow:hidden;
                background-color:#DDDDDD;
                @apply --layout-horizontal;
                @apply --ft-wizard-tab-bar;
            }
        </style>

        <div
            id="base"
            class="layout horizontal"
        >
            <template
                    is="dom-repeat"
                    items="[[items]]"
                    as="item">

                <ft-wizard-tab
                    name="[[item.name]]"
                    style="width:120px; "
                    title="[[item.title]]"
                    subtitle="[[item.subtitle]]"
                >
                </ft-wizard-tab>

            </template>
        </div>


    </template>

    <script>
        Polymer({

            is: 'ft-wizard-tab-bar',

            listeners:
            {
                'wizard-tab-clicked': '_onTabClicked'
            },

            properties: {

                selected:
                {
                    type: String,
                    notify: true,
                    observer: "_onSelectedChanged"
                },

                items:
                {
                    type: Array,
                    value: []
                }
            },
            
            _onTabClicked: function(event)
            {
                var name = event.detail;
                this.selected = name;
            },

            _onSelectedChanged: function(toName, fromName)
            {
                if (fromName)
                {
                    // Deselect this tab
                    var fromTab = this._findTabWithName(fromName);
                    if (!!fromTab)
                        fromTab.selected = false;

                    // Deselect the tail in the tab before this one
                    var previousTab = this._getPreviousTab(fromName);
                    if (!!previousTab)
                        previousTab.nextSelected = false;
                }
                if (toName)
                {
                    // Select this tab
                    var toTab = this._findTabWithName(toName);
                    if (!!toTab)
                        toTab.selected = true;

                    // Select the tail in the tab before this one
                    var previousTab = this._getPreviousTab(toName);
                    if (!!previousTab)
                        previousTab.nextSelected = true;
                }
            },

            _findTabWithName: function(name)
            {
                var index = this._findIndexOfTabWithName(name);
                if (index === null)
                    return null;
                var tab = this._getTabAt(index);
                return tab;
            },

            _findIndexOfTabWithName: function(name)
            {
                // TODO: There must be a better way to do this...
                var base = this.$.base;
                var children = Polymer.dom(base).querySelectorAll('ft-wizard-tab');
                var count = children.length;
                for (var index = 0;
                     index < count;
                     index++)
                {
                    var child = children[index];
                    if (child.name === name)
                        return index;
                }
                return null;
            },

            selectPrevious: function()
            {
                var previousTab = this._getPreviousTab(this.selected);
                if (!previousTab)
                    return;
                this.selected = previousTab.name;
            },

            selectNext: function()
            {
                var nextTab = this._getNextTab(this.selected);
                if (!nextTab)
                    return;
                this.selected = nextTab.name;
            },

            _getNextTab: function(name)
            {
                var index = this._findIndexOfTabWithName(name);
                if (index === null)
                    return null;
                var items = this.items;
                var lastIndex = items.length - 1;
                var nextTabIndex = index + 1;
                if (nextTabIndex > lastIndex)
                    return null;
                var nextTab = this._getTabAt(nextTabIndex);
                return nextTab;
            },

            _getPreviousTab: function(name)
            {
                var index = this._findIndexOfTabWithName(name);
                if (index === null)
                    return null;
                var previousTabIndex = index - 1;
                if (previousTabIndex < 0)
                    return null;
                var previousTab = this._getTabAt(previousTabIndex);
                return previousTab;
            },

            _getTabAt: function(index)
            {
                var base = this.$.base;
                var children = Polymer.dom(base).querySelectorAll('ft-wizard-tab');
                return children[index];
            },

        });
    </script>
</dom-module>

